# ??? Scraper (??? 스크래퍼)

## 1. 프로젝트 소개
Node.js와 Express를 기반으로 특정 갤러리의 게시글과 댓글을 작성한 유저정보를 스크래핑하여 DB에 저장하는 프로젝트입니다. 
대규모 비동기 요청 처리, IP 차단 우회, 대량 데이터의 효율적인 DB 삽입 등 웹 스크래핑 과정에서 발생하는 다양한 기술적 문제들을 해결하는 데 중점을 두었습니다.


## 2. 주요 기능
- 지정된 갤러리 게시글 목록 스크래핑
- 각 게시글의 작성자, 게시글 번호, 갤러리 코드 수집
- 게시글 내 모든 댓글 정보 수집
- 수집된 데이터를 MySQL 데이터베이스에 저장


## 3. 사용 기술 (Tech Stack)
- **Backend:** Node.js, Express.js
- **Database:** MySQL
- **Libraries:** Cheerio (HTML 파싱), Axios (HTTP 요청) 등


## 4. 문제 해결 과정

**1) 대량 데이터 삽입 시 DB에서 발생하는 데드락, 정합성 문제**
- 문제: 병렬 `INSERT, UPDATE`시도 시, 트랜잭션과 명시적 잠금 유무에 따른 데드락 및 경쟁 상태가 발생함.

- 해결 방안: MySQL DBMS의 잠금 특성을 점검하여, 트랜잭션 격리 수준을 `Read Committed`로 조정하고 애플리케이션 단에서 데이터를 미리 정제하여 DAO에서 처리하도록 로직을 변경함.

- 결과: 데드락, 경쟁 상태가 모두 해결되어 비즈니스 로직에 맞는 정상적인 데이터 수집이 가능해졌음.

관련 블로그 링크
[1. 명시적 락을 언제 사용할까?](https://velog.io/@7vosakrehc7/명시적-락을-언제-사용할까)
[2. 갭 락과 데드락의 관계](https://velog.io/@7vosakrehc7/갭-락과-데드락)

**2) API 요청 시 반복적인 요청으로 인한 차단 문제**
- 문제: 단시간에 서버가 지정한 제한을 넘는 요청을 전송하여 차단이 발생하였음.

- 해결 방안: 요청 간 지연 설정, 지수 백오프와 지터를 이용한 재시도 로직 추가, `User-Agent` 랜덤 설정

- 결과: 단위 시간 당 요청이 감소하여 자연스럽게 차단율이 감소함.

- 추가 고려 중인 방안: 프록시 서버 이용, `X-ratelimit-remaining` 응답 헤더 힌트를 통해 요청 간 지연 간격 설정 (서버의 remaining 초기화 기준 간격과 불확실한 remaining 값 변화)

